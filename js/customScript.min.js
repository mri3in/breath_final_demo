function assignDataTable(e){$("#"+e).DataTable({fixedHeader:{headerOffset:$("#myNavbar").outerHeight()}}),$("#"+e).attr("style","")}function disableEnter(e){$(e).bind("keypress",function(e){return 13==e.keyCode?!1:void 0})}function redirectTab(){$("#myTab a").click(function(e){e.preventDefault(),$(this).tab("show")});var e=document.location.hash,t="tab_";e&&$(".nav-tabs a[href="+e.replace(t,"")+"]").tab("show"),$(".nav-tabs a").on("shown.bs.tab",function(e){window.location.hash=e.target.hash.replace("#","#"+t)})}function progressBar(e){e(".pie_progress").asPieProgress({namespace:"pie_progress",min:0,max:100,speed:30}),e('a[data-toggle="tab"]').on("shown.bs.tab",function(){e(".pie_progress").asPieProgress("start")}),e(".pie_progress").asPieProgress("start")}function addRow(e,t){var o,r;"order"==t?(o=config.order,r=message.order):"quotation"==t?(o=config.quotation,r=message.quotation):"issue"==t&&(o=config.issue,r=message.issue);var n=document.getElementById(e),i=n.rows.length;if(i<o.lineMaxRowCount){var a=n.insertRow(i),s=n.rows[0].cells.length;a.id="row-"+(i-1);for(var l=0;s>l;l++){var c=a.insertCell(l);if(c.id=a.id+"_col-"+l,l==o.lineIDCol)c.setAttribute("hidden","true"),c.innerHTML=n.rows[1].cells[l].innerHTML,console.log("lineID : "+n.rows[1].cells[l].innerHTML);else if(l==o.selectionCol){var u=function(){var e=config.prefixSelectionID+(i-1),t=n.rows[1].cells[l].innerHTML.replace(config.defaultSelectionID,e);return t};c.innerHTML=u(),console.log("selection ID: "+c.innerHTML)}else if(l==o.quantityCol||l==o.priceCol)c.innerHTML=n.rows[1].cells[l].innerHTML,$("#"+c.id+" input").attr("oninput","calculatePrice('"+a.id+"', '"+t+"')"),"issue"==t&&l==o.priceCol&&c.setAttribute("hidden","true"),console.log("quantity + price: "+c.innerHTML);else if(l==o.selectionNameCol){var d=function(){var e=config.prefixSelectionName+(i-1),t=n.rows[1].cells[l].innerHTML.replace(config.defaultSelectionName,e);return t};c.innerHTML=d(),console.log("selection name: "+c.innerHTML)}else if(l==o.storageLocationCol){var m=function(){var e=config.prefixSelectionStorageID+(i-1),t=n.rows[1].cells[l].innerHTML.replace(config.defaultSelectionStorageID,e);return t};c.innerHTML=m(),console.log("selection name: "+c.innerHTML)}else c.innerHTML=n.rows[1].cells[l].innerHTML,console.log("others: "+c.innerHTML);$("#"+c.id+" select").val(0),$("#"+c.id+" input").attr("value","")}}else alert(r.maxLine)}function deleteRow(e,t){var o,r;"order"==t?(o=config.order,r=message.order):"quotation"==t?(o=config.quotation,r=message.quotation):(t="issue")&&(o=config.issue,r=message.issue);for(var n=document.getElementById(e),i=n.rows.length,a=0;i>a;a++){var s=n.rows[a],l=s.cells[0].childNodes[0];if(null!=l&&1==l.checked){if(1>=i){alert(r.minLine);break}n.deleteRow(a),i--,a--,calculatePrice("",t)}}for(var c=1;i>c;c++){var u=n.rows[0].cells.length,d=c-1;n.rows[c].id="row-"+d;for(var m=0;u>m;m++)if(m==o.selectionCol){n.rows[c].cells[m].id="row-"+d+"_col-"+m;var p=config.prefixSelectionID+d;$("#"+n.rows[c].cells[m].id+" select").attr("id",p)}else if(m==o.selectionNameCol){n.rows[c].cells[m].id="row-"+d+"_col-"+m;var g=config.prefixSelectionName+d;$("#"+n.rows[c].cells[m].id+" select").attr("id",g)}else if(m==o.storageLocationCol){n.rows[c].cells[m].id="row-"+d+"_col-"+m;var h=config.prefixSelectionStorageID+d;$("#"+n.rows[c].cells[m].id+" select").attr("id",h)}else if(m==o.quantityCol||m==o.priceCol){n.rows[c].cells[m].id="row-"+d+"_col-"+m;var f="calculatePrice('row-"+d+"','"+t+"')";$("#"+n.rows[c].cells[m].id+" input").attr("oninput",f)}else n.rows[c].cells[m].id="row-"+d+"_col-"+m}}function sellingPrice(e,t){var o;"order"==t?o=config.order:"quotation"==t?o=config.quotation:"issue"==t?o=config.issue:"receipt"==t&&(o=config.receipt);var r,n=e+"_col-"+o.quantityCol,i=e+"_col-"+o.priceCol,a=e+"_col-"+o.totalPriceCol,s=document.getElementById(n).getElementsByTagName("input")[0].value,l=document.getElementById(i).getElementsByTagName("input")[0].value;r=o.currencyExchangeRateID?s*l*$("#"+o.currencyExchangeRateID).val():s*l,$("#"+a+" input").attr({readonly:!1,value:r,readonly:!0})}function sumNetTotal(e){var t,o;"order"==e?o=config.order:"quotation"==e?o=config.quotation:"issue"==e&&(o=config.issue),t=document.getElementsByName(o.netPriceInputName),console.log("net price input name : "+o.netPriceInputName);for(var r=0,n=0;n<t.length;n++)parseInt(t[n].value)&&(r+=parseInt(t[n].value));return $("#"+config.netTotalID).attr({readonly:!1,value:r,readonly:!0}),r}function sumTax(e){var t,o,r=document.getElementsByName(config.taxLineInputName),n=.01,i=0;if("order"==e)o=config.order;else if("quotation"==e)o=config.quotation;else if("issue"==e)return i;t=document.getElementsByName(o.netPriceInputName);for(var a=0;a<t.length;a++)parseInt(t[a].value)&&parseInt(r[a].value)&&(i+=parseInt(r[a].value)*parseInt(t[a].value)*n);return $("#"+config.totalTaxID).attr("readonly",!1),document.getElementById(config.totalTaxID).value=i,$("#"+config.totalTaxID).attr("readonly",!0),i}function calculatePrice(e,t){e&&sellingPrice(e,t),$("#"+config.totalID).attr({readonly:!1,value:sumNetTotal(t)+sumTax(t),readonly:!0})}function displayDetails(e,t,o,r,n){return""==e?void alert(message.displayDetails.noAttributeID):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status)switch(t){case"item":displayItemDetails(r,n);break;case"customer":displayCustomerDetails(e,o);break;case"order":displayOrderDetails(e,o,r)}},xmlhttp.open("GET","../php/"+config.searchPHPName+".php?search="+e+"&searchType="+t,!0),xmlhttp.send(),void 0)}function displayCustomerDetails(e,t){return""==e?void alert(message.displayDetails.noAttributeID):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){$("#"+t).show();var e=JSON.parse(xmlhttp.responseText);console.log(e),$("#"+config.customer.customerName).attr({readonly:!1,value:e[0].customerName,readonly:!0}),$("#"+config.customer.customerLongName).attr({readonly:!1,value:e[0].customerLongName,readonly:!0}),$("#"+config.customer.customerTaxCode).attr({readonly:!1,value:e[0].customerTaxCode,readonly:!0}),$("#"+config.customer.customerPhoneNumber).attr({readonly:!1,value:e[0].customerPhoneNumber,readonly:!0}),$("#"+config.customer.customerStatus).attr({readonly:!1,value:e[0].customerStatus,readonly:!0}),$("#"+config.customer.customerSalespersonAccountable).is("select")?$("#"+config.customer.customerSalespersonAccountable).val(e[0].customerSalespersonAccountableID):$("#"+config.customer.customerSalespersonAccountable).is("input")&&$("#"+config.customer.customerSalespersonAccountable).attr({readonly:!1,value:e[0].customerSalespersonAccountableName,readonly:!0}),$("#"+config.customer.customerBillingAddressStreet).attr({readonly:!1,value:e[0].customerBillingAddressStreet,readonly:!0}),$("#"+config.customer.customerBillingAddressCountry).attr({readonly:!1,value:e[0].customerBillingAddressCountry,readonly:!0}),$("#"+config.customer.customerBillingAddressCity).attr({readonly:!1,value:e[0].customerBillingAddressCity,readonly:!0}),$("#"+config.customer.customerShippingAddressStreet).attr({readonly:!1,value:e[0].customerShippingAddressStreet}),console.log(e[0].customerShippingAddressCountry),$("#"+config.customer.customerShippingAddressCountry).val(e[0].customerShippingAddressCountry),populateStates(config.customer.customerShippingAddressCountry,config.customer.customerShippingAddressCity),$("#"+config.customer.customerShippingAddressCity).val(e[0].customerShippingAddressCity),$("#"+config.customer.customerCreditLimit).attr({readonly:!1,value:e[0].customerCreditLimit,readonly:!0}),$("#"+config.customer.customerCurrentCredit).attr({readonly:!1,value:e[0].customerCurrentCredit,readonly:!0}),$("#"+config.customer.customerPaymentTerm).attr({readonly:!1,value:e[0].customerPaymentTerm,readonly:!0})}},xmlhttp.open("GET","../php/"+config.searchPHPName+".php?search="+e+"&searchType=customer",!0),xmlhttp.send(),void 0)}function displayItemDetails(e,t,o){var r,n=t.slice(-1);return""==e?void alert(message.displayDetails.noAttributeID):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){switch(o){case"order":r=config.order;break;case"quotation":r=config.quotation;break;case"receipt":r=config.receipt}var e=JSON.parse(xmlhttp.responseText);r.manufacturerCol&&$("#row-"+n+"_col-"+r.manufacturerCol+" input").attr({readonly:!1,value:e[0].itemManufacturer,readonly:!0}),r.vendorCol&&$("#row-"+n+"_col-"+r.vendorCol+" input").attr({readonly:!1,value:e[0].itemVendor,readonly:!0}),r.priceCol&&$("#row-"+n+"_col-"+r.priceCol+" input").attr({readonly:!1,value:e[0].itemPrice}),r.taxCol&&$("#row-"+n+"_col-"+r.taxCol+" input").attr({readonly:!1,value:e[0].itemVAT,readonly:!0})}},xmlhttp.open("GET","../php/"+config.searchPHPName+".php?search="+e+"&searchType=item",!0),xmlhttp.send(),void 0)}function displayOrderDetails(e,t,o){var r,n;return""==e?void alert(message.displayDetails.noAttributeID):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var e=JSON.parse(xmlhttp.responseText);if(console.log(e),console.log("single first item: "+e[0]),console.log("single last item: "+e[e.length-1]),$("#"+t).show(),e.length>0){$("#"+config.issue.customerNameID).attr({readonly:!1,value:e[0].customerLongName,readonly:!0}),$("#"+config.issue.customerBillingAddressID).attr({readonly:!1,value:e[0].customerBillingAddress,readonly:!0}),$("#"+config.issue.customerShippingAddressID).attr({readonly:!1,value:e[0].orderShippingAddress,readonly:!0}),orderLineIdList=e[0].orderLineID.split("|"),console.log("order line id list: "+orderLineIdList),r=e[0].itemLineID.split("|"),n=e[0].itemLineName.split("|");var i=document.getElementById(o);$("#"+o+" select").find("option").remove().end(),$("#"+o+" input").attr("value","");for(var a=0;a<i.rows.length;a++)for(var s=0;s<r.length;s++)$("#item_id_select_"+a).append($("<option></option>").val(r[s]).html(r[s])),$("#item_name_select_"+a).append($("<option></option>").val(r[s]).html(n[s]))}setTimeout(displayOrderLineDetails("0","item_name_select_0"),1e3)}},xmlhttp.open("GET","../php/"+config.searchPHPName+".php?search="+e+"&searchType=order",!0),void xmlhttp.send())}function displayOrderLineDetails(e,t){var o,r,n,i=t.slice(-1);return""===e?(console.log(e),void alert(message.displayDetails.noAttributeID)):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),console.log("select index: "+e),o=orderLineIdList[e],xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var o=JSON.parse(xmlhttp.responseText);if(console.log(xmlhttp.responseText),console.log(o),"success"==o.result){r=o.storageLocationId.split("|"),itemStorageLocationIdList=o.itemStorageLocationId.split("|"),$("#row-"+i+"_col-"+config.issue.lineIDCol+" input").attr({value:o.orderLineID}),console.log("order Line ID: "+o.orderLineID),$("#row-"+i+"_col-"+config.issue.selectionCol+" select").prop("selectedIndex",e),$("#row-"+i+"_col-"+config.issue.selectionNameCol+" select").prop("selectedIndex",e),console.log("#row-"+i+"_col-"+config.issue.selectionNameCol+" select index: "+e),$("#row-"+i+"_col-"+config.issue.issuedOrderedQuantityCol+" input").attr({readonly:!1,value:o.issuedQuantity+"/"+o.orderedQuantity,readonly:!0}),$("#storage_location_select_"+i).find("option").remove().end();for(var a=0;a<r.length;a++)$("#storage_location_select_"+i).append($("<option></option>").val(itemStorageLocationIdList[a]).html(r[a]));$("#row-"+i+"_col-"+config.issue.itemUnitOfMeasurementCol+" input").attr({readonly:!1,value:o.itemUnitOfMeasurement,readonly:!0}),console.log("#row-"+i+"_col-"+config.issue.itemUnitOfMeasurementCol+" input : "+o.itemUnitOfMeasurement),n=o.deliveryDate,$("#row-"+i+"_col-"+config.issue.deliveryDateCol+" input").attr({readonly:!1,value:n.substr(0,10),readonly:!0}),console.log("#row-"+i+"_col-"+config.issue.deliveryDateCol+" input : "+n.substr(0,10)),$("#row-"+i+"_col-"+config.issue.priceCol+" input").attr({readonly:!1,value:o.orderLineSellingPrice,readonly:!0}),console.log("#row-"+i+"_col-"+config.issue.priceCol+" input : "+o.orderLineSellingPrice)}setTimeout(displayItemStorageLocationDetails(0,t),1e3)}},xmlhttp.open("GET","../php/"+config.searchPHPName+".php?search="+o+"&searchType=order_line",!0),void xmlhttp.send())}function displayItemStorageLocationDetails(e,t){var o,r=t.slice(-1);return""===e?(console.log(e),void alert(message.displayDetails.noAttributeID)):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),console.log("select index: "+e),o=itemStorageLocationIdList[e],xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var e=JSON.parse(xmlhttp.responseText);console.log(xmlhttp.responseText),console.log(e),"success"==e.result&&$("#row-"+r+"_col-"+config.issue.inStockCol+" input").attr({readonly:!1,value:e.itemStorageLocationQuantity,readonly:!0})}},xmlhttp.open("GET","../php/"+config.searchPHPName+".php?search="+o+"&searchType=item_storage_location",!0),void xmlhttp.send())}function displayStorageLocationDetails(e,t){return""===e?(console.log(e),void alert(message.displayDetails.noAttributeID)):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var e=JSON.parse(xmlhttp.responseText);console.log(xmlhttp.responseText),"success"==e.result&&($("#"+t).show(),$("#"+config.receipt.storageLocationShelfID).attr({readonly:!1,value:e.storage_location_shelf,readonly:!0}),$("#"+config.receipt.storageLocationRowID).attr({readonly:!1,value:e.storage_location_row,readonly:!0}),$("#"+config.receipt.storageLocationColumnID).attr({readonly:!1,value:e.storage_location_column,readonly:!0}),$("#"+config.receipt.storageLocationColumnID).attr({readonly:!1,value:e.storage_location_condition,readonly:!0}))}},xmlhttp.open("GET","../php/"+config.searchPHPName+".php?search="+e+"&searchType=storage_location",!0),void xmlhttp.send())}function displayStorageLocationIdList(e){return""===e?(console.log(e),void alert(message.displayDetails.noAttributeID)):(window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var e=JSON.parse(xmlhttp.responseText);if(console.log(xmlhttp.responseText),"success"==e.result){var t=e.storage_location_id_list.split("|");$("#storage_location_id_select").find("option").remove().end();for(var o=0;o<t.length;o++)$("#storage_location_id_select").append($("<option></option>").val(t[o]).html(t[o]))}}},xmlhttp.open("GET","../php/"+config.searchPHPName+".php?search="+e+"&searchType=warehouse",!0),void xmlhttp.send())}var config={quotation:{lineIDCol:"1",selectionCol:"2",manufacturerCol:"3",quantityCol:"4",vendorCol:"5",priceCol:"6",totalPriceCol:"7",taxCol:"8",selectionNameCol:"",storageLocationCol:"",unitCostCol:"",currencyExchangeRateID:"",netPriceInputName:"quotation_line_estimate_net_price[]",lineMaxRowCount:"10"},order:{lineIDCol:"1",selectionCol:"2",manufacturerCol:"3",quantityCol:"4",vendorCol:"5",priceCol:"7",totalPriceCol:"8",taxCol:"9",selectionNameCol:"",storageLocationCol:"",unitCostCol:"",currencyExchangeRateID:"",netPriceInputName:"order_line_net_selling_price[]",lineMaxRowCount:"10"},issue:{customerNameID:"customer_long_name",customerBillingAddressID:"customer_billing_address",customerShippingAddressID:"customer_shipping_address",lineIDCol:"1",selectionCol:"2",selectionNameCol:"3",issuedOrderedQuantityCol:"4",quantityCol:"5",storageLocationCol:"6",inStockCol:"7",itemUnitOfMeasurementCol:"8",deliveryDateCol:"9",totalPriceCol:"10",priceCol:"11",unitCostCol:"",currencyExchangeRateID:"",netPriceInputName:"transaction_line_value[]",lineMaxRowCount:"10"},receipt:{storageLocationDisplayID:"storage_location_detail_display",storageLocationShelfID:"storage_location_shelf",storageLocationRowID:"storage_location_row",storageLocationColumnID:"storage_location_column",storageLocationConditionID:"storage_location_condition",lineIDCol:"1",selectionCol:"2",vendorCol:"3",quantityCol:"4",unitCostCol:"5",totalPriceCol:"6",inStockCol:"",itemUnitOfMeasurementCol:"",deliveryDateCol:"",priceCol:"",currencyExchangeRateID:"exchange_rate",netPriceInputName:"item_total_cost[]",lineMaxRowCount:"10"},defaultSelectionID:"item_id_select_0",prefixSelectionID:"item_id_select_",defaultSelectionName:"item_name_select_0",prefixSelectionName:"item_name_select_",defaultSelectionStorageID:"storage_location_select_0",prefixSelectionStorageID:"storage_location_select_",taxLineInputName:"item_VAT[]",netTotalID:"netTotal",totalTaxID:"totalTax",totalID:"total",searchPHPName:"display_detail",selectedCountryIndex:{country:"243",city:"27"},customer:{customerName:"customer_name",customerLongName:"customer_long_name",customerTaxCode:"customer_tax_code",customerPhoneNumber:"customer_phone_number",customerStatus:"customer_status",customerSalespersonAccountable:"staff_id",customerBillingAddress:"customer_billing_address",customerBillingAddressStreet:"customer_billing_address_street",customerBillingAddressCountry:"customer_billing_address_country",customerBillingAddressCity:"customer_billing_address_city",customerShippingAddress:"customer_shipping_address",customerShippingAddressStreet:"customer_shipping_address_street",customerShippingAddressCountry:"customer_shipping_address_country",customerShippingAddressCity:"customer_shipping_address_city",customerCreditLimit:"customer_credit_limit",customerCurrentCredit:"customer_current_credit",customerPaymentTerm:"customer_payment_term"}},message={quotation:{maxLine:"Maximum quotation line per quotation is "+config.quotation.lineMaxRowCount+"!",minLine:"Cannot remove all the quotation lines."},order:{maxLine:"Maximum order line per order is "+config.order.lineMaxRowCount+"!",minLine:"Cannot remove all the order lines."},issue:{maxLine:"Maximum issue line per transaction is "+config.issue.lineMaxRowCount+"!",minLine:"Cannot remove all the transaction lines."},displayDetails:{noAttributeID:"Please select one!"}};$(function(){$("#header").load("../html/partials/navigation.html"),$("#footer").load("../html/partials/footer.html"),$("#tabItem").load("item.html"),$("#tabWarehouse").load("warehouse.html"),$("#tabStorageLocation").load("storage_location.html"),$("#tabCustomer").load("customer.html"),$("#tabOrder").load("order.html"),$("#tabQuotation").load("quotation.html")});var orderLineIdList,itemStorageLocationIdList;